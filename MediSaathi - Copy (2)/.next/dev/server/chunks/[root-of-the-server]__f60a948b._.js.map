{
  "version": 3,
  "sources": [],
  "sections": [
    {"offset": {"line": 46, "column": 0}, "map": {"version":3,"sources":["file:///D:/MediSaathi/lib/supabase.ts"],"sourcesContent":["import { createClient } from '@supabase/supabase-js'\r\n\r\nconst supabaseUrl = process.env.NEXT_PUBLIC_SUPABASE_URL!\r\nconst supabaseAnonKey = process.env.NEXT_PUBLIC_SUPABASE_ANON_KEY!\r\n\r\nexport const supabase = createClient(supabaseUrl, supabaseAnonKey)\r\n\r\n// Database Types\r\nexport type Database = {\r\n  public: {\r\n    Tables: {\r\n      users: {\r\n        Row: {\r\n          id: string\r\n          email: string\r\n          full_name: string | null\r\n          avatar_url: string | null\r\n          user_type: 'patient' | 'doctor' | 'hospital'\r\n          phone: string | null\r\n          date_of_birth: string | null\r\n          gender: string | null\r\n          address: string | null\r\n          created_at: string\r\n          updated_at: string\r\n        }\r\n        Insert: {\r\n          id?: string\r\n          email: string\r\n          full_name?: string | null\r\n          avatar_url?: string | null\r\n          user_type: 'patient' | 'doctor' | 'hospital'\r\n          phone?: string | null\r\n          date_of_birth?: string | null\r\n          gender?: string | null\r\n          address?: string | null\r\n          created_at?: string\r\n          updated_at?: string\r\n        }\r\n        Update: {\r\n          id?: string\r\n          email?: string\r\n          full_name?: string | null\r\n          avatar_url?: string | null\r\n          user_type?: 'patient' | 'doctor' | 'hospital'\r\n          phone?: string | null\r\n          date_of_birth?: string | null\r\n          gender?: string | null\r\n          address?: string | null\r\n          updated_at?: string\r\n        }\r\n      }\r\n      family_members: {\r\n        Row: {\r\n          id: string\r\n          user_id: string\r\n          full_name: string\r\n          relationship: string\r\n          date_of_birth: string\r\n          gender: string\r\n          phone: string | null\r\n          emergency_contact: boolean\r\n          created_at: string\r\n          updated_at: string\r\n        }\r\n        Insert: {\r\n          id?: string\r\n          user_id: string\r\n          full_name: string\r\n          relationship: string\r\n          date_of_birth: string\r\n          gender: string\r\n          phone?: string | null\r\n          emergency_contact?: boolean\r\n          created_at?: string\r\n          updated_at?: string\r\n        }\r\n        Update: {\r\n          id?: string\r\n          user_id?: string\r\n          full_name?: string\r\n          relationship?: string\r\n          date_of_birth?: string\r\n          gender?: string\r\n          phone?: string | null\r\n          emergency_contact?: boolean\r\n          updated_at?: string\r\n        }\r\n      }\r\n      doctors: {\r\n        Row: {\r\n          id: string\r\n          user_id: string\r\n          specialty: string\r\n          license_number: string\r\n          experience_years: number\r\n          education: string | null\r\n          hospital_id: string | null\r\n          consultation_fee: number | null\r\n          available_days: string[]\r\n          available_hours: string\r\n          bio: string | null\r\n          rating: number\r\n          total_patients: number\r\n          created_at: string\r\n          updated_at: string\r\n        }\r\n        Insert: {\r\n          id?: string\r\n          user_id: string\r\n          specialty: string\r\n          license_number: string\r\n          experience_years: number\r\n          education?: string | null\r\n          hospital_id?: string | null\r\n          consultation_fee?: number | null\r\n          available_days?: string[]\r\n          available_hours?: string\r\n          bio?: string | null\r\n          rating?: number\r\n          total_patients?: number\r\n          created_at?: string\r\n          updated_at?: string\r\n        }\r\n        Update: {\r\n          id?: string\r\n          user_id?: string\r\n          specialty?: string\r\n          license_number?: string\r\n          experience_years?: number\r\n          education?: string | null\r\n          hospital_id?: string | null\r\n          consultation_fee?: number | null\r\n          available_days?: string[]\r\n          available_hours?: string\r\n          bio?: string | null\r\n          rating?: number\r\n          total_patients?: number\r\n          updated_at?: string\r\n        }\r\n      }\r\n      hospitals: {\r\n        Row: {\r\n          id: string\r\n          user_id: string\r\n          name: string\r\n          address: string\r\n          phone: string\r\n          email: string\r\n          website: string | null\r\n          license_number: string\r\n          total_beds: number\r\n          available_beds: number\r\n          departments: string[]\r\n          services: string[]\r\n          emergency_services: boolean\r\n          rating: number\r\n          created_at: string\r\n          updated_at: string\r\n        }\r\n        Insert: {\r\n          id?: string\r\n          user_id: string\r\n          name: string\r\n          address: string\r\n          phone: string\r\n          email: string\r\n          website?: string | null\r\n          license_number: string\r\n          total_beds: number\r\n          available_beds: number\r\n          departments: string[]\r\n          services: string[]\r\n          emergency_services?: boolean\r\n          rating?: number\r\n          created_at?: string\r\n          updated_at?: string\r\n        }\r\n        Update: {\r\n          id?: string\r\n          user_id?: string\r\n          name?: string\r\n          address?: string\r\n          phone?: string\r\n          email?: string\r\n          website?: string | null\r\n          license_number?: string\r\n          total_beds?: number\r\n          available_beds?: number\r\n          departments?: string[]\r\n          services?: string[]\r\n          emergency_services?: boolean\r\n          rating?: number\r\n          updated_at?: string\r\n        }\r\n      }\r\n      health_records: {\r\n        Row: {\r\n          id: string\r\n          user_id: string\r\n          family_member_id: string | null\r\n          title: string\r\n          type: 'lab_report' | 'prescription' | 'xray' | 'scan' | 'consultation' | 'other'\r\n          file_url: string | null\r\n          file_type: string | null\r\n          content: string | null\r\n          doctor_id: string | null\r\n          hospital_id: string | null\r\n          date_recorded: string\r\n          ai_summary: string | null\r\n          tags: string[]\r\n          is_critical: boolean\r\n          created_at: string\r\n          updated_at: string\r\n        }\r\n        Insert: {\r\n          id?: string\r\n          user_id: string\r\n          family_member_id?: string | null\r\n          title: string\r\n          type: 'lab_report' | 'prescription' | 'xray' | 'scan' | 'consultation' | 'other'\r\n          file_url?: string | null\r\n          file_type?: string | null\r\n          content?: string | null\r\n          doctor_id?: string | null\r\n          hospital_id?: string | null\r\n          date_recorded: string\r\n          ai_summary?: string | null\r\n          tags?: string[]\r\n          is_critical?: boolean\r\n          created_at?: string\r\n          updated_at?: string\r\n        }\r\n        Update: {\r\n          id?: string\r\n          user_id?: string\r\n          family_member_id?: string | null\r\n          title?: string\r\n          type?: 'lab_report' | 'prescription' | 'xray' | 'scan' | 'consultation' | 'other'\r\n          file_url?: string | null\r\n          file_type?: string | null\r\n          content?: string | null\r\n          doctor_id?: string | null\r\n          hospital_id?: string | null\r\n          date_recorded?: string\r\n          ai_summary?: string | null\r\n          tags?: string[]\r\n          is_critical?: boolean\r\n          updated_at?: string\r\n        }\r\n      }\r\n      vital_signs: {\r\n        Row: {\r\n          id: string\r\n          user_id: string\r\n          family_member_id: string | null\r\n          type: 'blood_pressure' | 'heart_rate' | 'temperature' | 'weight' | 'height' | 'blood_sugar' | 'oxygen_saturation'\r\n          value: string\r\n          unit: string\r\n          notes: string | null\r\n          recorded_at: string\r\n          created_at: string\r\n        }\r\n        Insert: {\r\n          id?: string\r\n          user_id: string\r\n          family_member_id?: string | null\r\n          type: 'blood_pressure' | 'heart_rate' | 'temperature' | 'weight' | 'height' | 'blood_sugar' | 'oxygen_saturation'\r\n          value: string\r\n          unit: string\r\n          notes?: string | null\r\n          recorded_at: string\r\n          created_at?: string\r\n        }\r\n        Update: {\r\n          id?: string\r\n          user_id?: string\r\n          family_member_id?: string | null\r\n          type?: 'blood_pressure' | 'heart_rate' | 'temperature' | 'weight' | 'height' | 'blood_sugar' | 'oxygen_saturation'\r\n          value?: string\r\n          unit?: string\r\n          notes?: string | null\r\n          recorded_at?: string\r\n        }\r\n      }\r\n      appointments: {\r\n        Row: {\r\n          id: string\r\n          patient_id: string\r\n          doctor_id: string\r\n          hospital_id: string | null\r\n          appointment_date: string\r\n          appointment_time: string\r\n          duration: number\r\n          type: 'consultation' | 'follow_up' | 'emergency' | 'telemedicine'\r\n          status: 'scheduled' | 'confirmed' | 'in_progress' | 'completed' | 'cancelled' | 'no_show'\r\n          reason: string\r\n          notes: string | null\r\n          prescription_id: string | null\r\n          fee: number | null\r\n          payment_status: 'pending' | 'paid' | 'refunded'\r\n          created_at: string\r\n          updated_at: string\r\n        }\r\n        Insert: {\r\n          id?: string\r\n          patient_id: string\r\n          doctor_id: string\r\n          hospital_id?: string | null\r\n          appointment_date: string\r\n          appointment_time: string\r\n          duration?: number\r\n          type: 'consultation' | 'follow_up' | 'emergency' | 'telemedicine'\r\n          status?: 'scheduled' | 'confirmed' | 'in_progress' | 'completed' | 'cancelled' | 'no_show'\r\n          reason: string\r\n          notes?: string | null\r\n          prescription_id?: string | null\r\n          fee?: number | null\r\n          payment_status?: 'pending' | 'paid' | 'refunded'\r\n          created_at?: string\r\n          updated_at?: string\r\n        }\r\n        Update: {\r\n          id?: string\r\n          patient_id?: string\r\n          doctor_id?: string\r\n          hospital_id?: string | null\r\n          appointment_date?: string\r\n          appointment_time?: string\r\n          duration?: number\r\n          type?: 'consultation' | 'follow_up' | 'emergency' | 'telemedicine'\r\n          status?: 'scheduled' | 'confirmed' | 'in_progress' | 'completed' | 'cancelled' | 'no_show'\r\n          reason?: string\r\n          notes?: string | null\r\n          prescription_id?: string | null\r\n          fee?: number | null\r\n          payment_status?: 'pending' | 'paid' | 'refunded'\r\n          updated_at?: string\r\n        }\r\n      }\r\n      prescriptions: {\r\n        Row: {\r\n          id: string\r\n          doctor_id: string\r\n          patient_id: string\r\n          appointment_id: string | null\r\n          medications: any[]\r\n          instructions: string | null\r\n          valid_until: string\r\n          status: 'active' | 'expired' | 'cancelled'\r\n          created_at: string\r\n          updated_at: string\r\n        }\r\n        Insert: {\r\n          id?: string\r\n          doctor_id: string\r\n          patient_id: string\r\n          appointment_id?: string | null\r\n          medications: any[]\r\n          instructions?: string | null\r\n          valid_until: string\r\n          status?: 'active' | 'expired' | 'cancelled'\r\n          created_at?: string\r\n          updated_at?: string\r\n        }\r\n        Update: {\r\n          id?: string\r\n          doctor_id?: string\r\n          patient_id?: string\r\n          appointment_id?: string | null\r\n          medications?: any[]\r\n          instructions?: string | null\r\n          valid_until?: string\r\n          status?: 'active' | 'expired' | 'cancelled'\r\n          updated_at?: string\r\n        }\r\n      }\r\n    }\r\n  }\r\n}"],"names":[],"mappings":";;;;AAAA;;AAEA,MAAM;AACN,MAAM;AAEC,MAAM,WAAW,IAAA,uNAAY,EAAC,aAAa"}},
    {"offset": {"line": 59, "column": 0}, "map": {"version":3,"sources":["file:///D:/MediSaathi/lib/services/health-record.service.ts"],"sourcesContent":["import { supabase } from '@/lib/supabase'\r\nimport type { Database } from '@/lib/supabase'\r\n\r\ntype HealthRecord = Database['public']['Tables']['health_records']['Row']\r\ntype HealthRecordInsert = Database['public']['Tables']['health_records']['Insert']\r\ntype HealthRecordUpdate = Database['public']['Tables']['health_records']['Update']\r\n\r\nexport class HealthRecordService {\r\n  // Get all health records for user\r\n  static async getHealthRecords(userId: string, familyMemberId?: string) {\r\n    try {\r\n      let query = supabase\r\n        .from('health_records')\r\n        .select(`\r\n          *,\r\n          doctors:doctor_id(full_name, specialty),\r\n          hospitals:hospital_id(name)\r\n        `)\r\n        .eq('user_id', userId)\r\n\r\n      if (familyMemberId) {\r\n        query = query.eq('family_member_id', familyMemberId)\r\n      }\r\n\r\n      const { data, error } = await query\r\n        .order('date_recorded', { ascending: false })\r\n\r\n      if (error) throw error\r\n      return { data, error: null }\r\n    } catch (error) {\r\n      return { data: null, error }\r\n    }\r\n  }\r\n\r\n  // Get single health record\r\n  static async getHealthRecord(recordId: string) {\r\n    try {\r\n      const { data, error } = await supabase\r\n        .from('health_records')\r\n        .select(`\r\n          *,\r\n          doctors:doctor_id(full_name, specialty),\r\n          hospitals:hospital_id(name),\r\n          family_members:family_member_id(full_name, relationship)\r\n        `)\r\n        .eq('id', recordId)\r\n        .single()\r\n\r\n      if (error) throw error\r\n      return { data, error: null }\r\n    } catch (error) {\r\n      return { data: null, error }\r\n    }\r\n  }\r\n\r\n  // Add new health record\r\n  static async addHealthRecord(recordData: HealthRecordInsert) {\r\n    try {\r\n      const { data, error } = await supabase\r\n        .from('health_records')\r\n        .insert(recordData)\r\n        .select()\r\n        .single()\r\n\r\n      if (error) throw error\r\n      return { data, error: null }\r\n    } catch (error) {\r\n      return { data: null, error }\r\n    }\r\n  }\r\n\r\n  // Update health record\r\n  static async updateHealthRecord(recordId: string, updates: HealthRecordUpdate) {\r\n    try {\r\n      const { data, error } = await supabase\r\n        .from('health_records')\r\n        .update(updates)\r\n        .eq('id', recordId)\r\n        .select()\r\n        .single()\r\n\r\n      if (error) throw error\r\n      return { data, error: null }\r\n    } catch (error) {\r\n      return { data: null, error }\r\n    }\r\n  }\r\n\r\n  // Delete health record\r\n  static async deleteHealthRecord(recordId: string) {\r\n    try {\r\n      const { error } = await supabase\r\n        .from('health_records')\r\n        .delete()\r\n        .eq('id', recordId)\r\n\r\n      if (error) throw error\r\n      return { error: null }\r\n    } catch (error) {\r\n      return { error }\r\n    }\r\n  }\r\n\r\n  // Get records by type\r\n  static async getRecordsByType(userId: string, type: string) {\r\n    try {\r\n      const { data, error } = await supabase\r\n        .from('health_records')\r\n        .select('*')\r\n        .eq('user_id', userId)\r\n        .eq('type', type)\r\n        .order('date_recorded', { ascending: false })\r\n\r\n      if (error) throw error\r\n      return { data, error: null }\r\n    } catch (error) {\r\n      return { data: null, error }\r\n    }\r\n  }\r\n\r\n  // Search records\r\n  static async searchRecords(userId: string, query: string) {\r\n    try {\r\n      const { data, error } = await supabase\r\n        .from('health_records')\r\n        .select('*')\r\n        .eq('user_id', userId)\r\n        .or(`title.ilike.%${query}%, content.ilike.%${query}%, tags.cs.{${query}}`)\r\n        .order('date_recorded', { ascending: false })\r\n\r\n      if (error) throw error\r\n      return { data, error: null }\r\n    } catch (error) {\r\n      return { data: null, error }\r\n    }\r\n  }\r\n\r\n  // Get critical records\r\n  static async getCriticalRecords(userId: string) {\r\n    try {\r\n      const { data, error } = await supabase\r\n        .from('health_records')\r\n        .select('*')\r\n        .eq('user_id', userId)\r\n        .eq('is_critical', true)\r\n        .order('date_recorded', { ascending: false })\r\n\r\n      if (error) throw error\r\n      return { data, error: null }\r\n    } catch (error) {\r\n      return { data: null, error }\r\n    }\r\n  }\r\n\r\n  // Upload file to Supabase Storage\r\n  static async uploadFile(file: File, userId: string): Promise<{url: string | null, error: any}> {\r\n    try {\r\n      const fileExt = file.name.split('.').pop()\r\n      const fileName = `${userId}/${Date.now()}-${Math.random().toString(36).substring(2)}.${fileExt}`\r\n\r\n      const { data, error } = await supabase.storage\r\n        .from('health-records')\r\n        .upload(fileName, file)\r\n\r\n      if (error) throw error\r\n\r\n      const { data: { publicUrl } } = supabase.storage\r\n        .from('health-records')\r\n        .getPublicUrl(fileName)\r\n\r\n      return { url: publicUrl, error: null }\r\n    } catch (error) {\r\n      return { url: null, error }\r\n    }\r\n  }\r\n\r\n  // Get analytics for records\r\n  static async getRecordsAnalytics(userId: string) {\r\n    try {\r\n      const { data, error } = await supabase\r\n        .from('health_records')\r\n        .select('type, created_at')\r\n        .eq('user_id', userId)\r\n\r\n      if (error) throw error\r\n\r\n      // Process analytics data\r\n      const analytics = {\r\n        total: data?.length || 0,\r\n        byType: {} as Record<string, number>,\r\n        byMonth: {} as Record<string, number>,\r\n        recentCount: 0\r\n      }\r\n\r\n      const lastMonth = new Date()\r\n      lastMonth.setMonth(lastMonth.getMonth() - 1)\r\n\r\n      data?.forEach(record => {\r\n        // Count by type\r\n        analytics.byType[record.type] = (analytics.byType[record.type] || 0) + 1\r\n        \r\n        // Count by month\r\n        const month = new Date(record.created_at).toISOString().substring(0, 7)\r\n        analytics.byMonth[month] = (analytics.byMonth[month] || 0) + 1\r\n        \r\n        // Count recent\r\n        if (new Date(record.created_at) > lastMonth) {\r\n          analytics.recentCount++\r\n        }\r\n      })\r\n\r\n      return { data: analytics, error: null }\r\n    } catch (error) {\r\n      return { data: null, error }\r\n    }\r\n  }\r\n}"],"names":[],"mappings":"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"}},
    {"offset": {"line": 273, "column": 0}, "map": {"version":3,"sources":["file:///D:/MediSaathi/app/api/health-records/route.ts"],"sourcesContent":["import { NextRequest, NextResponse } from 'next/server'\r\nimport { supabase } from '@/lib/supabase'\r\nimport { HealthRecordService } from '@/lib/services/health-record.service'\r\n\r\nexport async function GET(request: NextRequest) {\r\n  try {\r\n    const { searchParams } = new URL(request.url)\r\n    const action = searchParams.get('action')\r\n    const userId = searchParams.get('userId')\r\n\r\n    if (!userId) {\r\n      return NextResponse.json({ \r\n        success: false, \r\n        error: 'User ID is required' \r\n      }, { status: 400 })\r\n    }\r\n\r\n    switch (action) {\r\n      case 'get-records':\r\n        try {\r\n          const { data: records, error } = await supabase\r\n            .from('health_records')\r\n            .select(`\r\n              id,\r\n              title,\r\n              type,\r\n              date_recorded,\r\n              created_at,\r\n              file_url\r\n            `)\r\n            .eq('user_id', userId)\r\n            .order('date_recorded', { ascending: false })\r\n            .limit(50)\r\n\r\n          if (error) {\r\n            console.error('Database error:', error)\r\n            return NextResponse.json({ \r\n              success: false, \r\n              error: 'Failed to fetch health records',\r\n              details: error.message\r\n            }, { status: 500 })\r\n          }\r\n\r\n          return NextResponse.json({ \r\n            success: true, \r\n            data: records || [] \r\n          })\r\n\r\n        } catch (dbError) {\r\n          console.error('Database connection error:', dbError)\r\n          return NextResponse.json({ \r\n            success: false, \r\n            error: 'Database connection failed',\r\n            details: dbError instanceof Error ? dbError.message : 'Unknown error'\r\n          }, { status: 500 })\r\n        }\r\n\r\n      default:\r\n        return NextResponse.json({ \r\n          success: false, \r\n          error: 'Invalid action' \r\n        }, { status: 400 })\r\n    }\r\n\r\n  } catch (error) {\r\n    console.error('Health records API error:', error)\r\n    return NextResponse.json({ \r\n      success: false, \r\n      error: 'Internal server error',\r\n      details: error instanceof Error ? error.message : 'Unknown error'\r\n    }, { status: 500 })\r\n  }\r\n}\r\n\r\nexport async function POST(request: NextRequest) {\r\n  try {\r\n    const body = await request.json()\r\n    const { user_id, title, type, file_url, date_recorded } = body\r\n\r\n    if (!user_id || !title || !type) {\r\n      return NextResponse.json({ \r\n        success: false, \r\n        error: 'Missing required fields: user_id, title, type' \r\n      }, { status: 400 })\r\n    }\r\n\r\n    const { data: record, error } = await supabase\r\n      .from('health_records')\r\n      .insert({\r\n        user_id,\r\n        title,\r\n        type,\r\n        file_url: file_url || '',\r\n        date_recorded: date_recorded || new Date().toISOString()\r\n      })\r\n      .select()\r\n      .single()\r\n\r\n    if (error) {\r\n      console.error('Database error:', error)\r\n      return NextResponse.json({ \r\n        success: false, \r\n        error: 'Failed to create health record',\r\n        details: error.message\r\n      }, { status: 500 })\r\n    }\r\n\r\n    return NextResponse.json({ \r\n      success: true, \r\n      data: record \r\n    })\r\n\r\n  } catch (error) {\r\n    console.error('Health records POST API error:', error)\r\n    return NextResponse.json({ \r\n      success: false, \r\n      error: 'Internal server error',\r\n      details: error instanceof Error ? error.message : 'Unknown error'\r\n    }, { status: 500 })\r\n  }\r\n}\r\n\r\nexport async function PUT(request: NextRequest) {\r\n  try {\r\n    const body = await request.json()\r\n    const { recordId, updates } = body\r\n\r\n    if (!recordId) {\r\n      return NextResponse.json({ success: false, error: 'Record ID required' }, { status: 400 })\r\n    }\r\n\r\n    const result = await HealthRecordService.updateHealthRecord(recordId, updates)\r\n    if (result.error) throw result.error\r\n\r\n    return NextResponse.json({ \r\n      success: true, \r\n      data: result.data,\r\n      message: 'Health record updated successfully' \r\n    })\r\n  } catch (error) {\r\n    console.error('Health Record Update Error:', error)\r\n    return NextResponse.json({ success: false, error: 'Failed to update health record' }, { status: 500 })\r\n  }\r\n}\r\n\r\nexport async function DELETE(request: NextRequest) {\r\n  try {\r\n    const { searchParams } = new URL(request.url)\r\n    const recordId = searchParams.get('recordId')\r\n\r\n    if (!recordId) {\r\n      return NextResponse.json({ success: false, error: 'Record ID required' }, { status: 400 })\r\n    }\r\n\r\n    const { error } = await HealthRecordService.deleteHealthRecord(recordId)\r\n    if (error) throw error\r\n\r\n    return NextResponse.json({ \r\n      success: true, \r\n      message: 'Health record deleted successfully' \r\n    })\r\n  } catch (error) {\r\n    console.error('Health Record Delete Error:', error)\r\n    return NextResponse.json({ success: false, error: 'Failed to delete health record' }, { status: 500 })\r\n  }\r\n}"],"names":[],"mappings":"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"}}]
}