{
  "version": 3,
  "sources": [],
  "sections": [
    {"offset": {"line": 46, "column": 0}, "map": {"version":3,"sources":["file:///D:/MediSaathi/lib/supabase.ts"],"sourcesContent":["import { createClient } from '@supabase/supabase-js'\r\n\r\nconst supabaseUrl = process.env.NEXT_PUBLIC_SUPABASE_URL!\r\nconst supabaseAnonKey = process.env.NEXT_PUBLIC_SUPABASE_ANON_KEY!\r\n\r\nexport const supabase = createClient(supabaseUrl, supabaseAnonKey)\r\n\r\n// Database Types\r\nexport type Database = {\r\n  public: {\r\n    Tables: {\r\n      users: {\r\n        Row: {\r\n          id: string\r\n          email: string\r\n          full_name: string | null\r\n          avatar_url: string | null\r\n          user_type: 'patient' | 'doctor' | 'hospital'\r\n          phone: string | null\r\n          date_of_birth: string | null\r\n          gender: string | null\r\n          address: string | null\r\n          created_at: string\r\n          updated_at: string\r\n        }\r\n        Insert: {\r\n          id?: string\r\n          email: string\r\n          full_name?: string | null\r\n          avatar_url?: string | null\r\n          user_type: 'patient' | 'doctor' | 'hospital'\r\n          phone?: string | null\r\n          date_of_birth?: string | null\r\n          gender?: string | null\r\n          address?: string | null\r\n          created_at?: string\r\n          updated_at?: string\r\n        }\r\n        Update: {\r\n          id?: string\r\n          email?: string\r\n          full_name?: string | null\r\n          avatar_url?: string | null\r\n          user_type?: 'patient' | 'doctor' | 'hospital'\r\n          phone?: string | null\r\n          date_of_birth?: string | null\r\n          gender?: string | null\r\n          address?: string | null\r\n          updated_at?: string\r\n        }\r\n      }\r\n      family_members: {\r\n        Row: {\r\n          id: string\r\n          user_id: string\r\n          full_name: string\r\n          relationship: string\r\n          date_of_birth: string\r\n          gender: string\r\n          phone: string | null\r\n          emergency_contact: boolean\r\n          created_at: string\r\n          updated_at: string\r\n        }\r\n        Insert: {\r\n          id?: string\r\n          user_id: string\r\n          full_name: string\r\n          relationship: string\r\n          date_of_birth: string\r\n          gender: string\r\n          phone?: string | null\r\n          emergency_contact?: boolean\r\n          created_at?: string\r\n          updated_at?: string\r\n        }\r\n        Update: {\r\n          id?: string\r\n          user_id?: string\r\n          full_name?: string\r\n          relationship?: string\r\n          date_of_birth?: string\r\n          gender?: string\r\n          phone?: string | null\r\n          emergency_contact?: boolean\r\n          updated_at?: string\r\n        }\r\n      }\r\n      doctors: {\r\n        Row: {\r\n          id: string\r\n          user_id: string\r\n          specialty: string\r\n          license_number: string\r\n          experience_years: number\r\n          education: string | null\r\n          hospital_id: string | null\r\n          consultation_fee: number | null\r\n          available_days: string[]\r\n          available_hours: string\r\n          bio: string | null\r\n          rating: number\r\n          total_patients: number\r\n          created_at: string\r\n          updated_at: string\r\n        }\r\n        Insert: {\r\n          id?: string\r\n          user_id: string\r\n          specialty: string\r\n          license_number: string\r\n          experience_years: number\r\n          education?: string | null\r\n          hospital_id?: string | null\r\n          consultation_fee?: number | null\r\n          available_days?: string[]\r\n          available_hours?: string\r\n          bio?: string | null\r\n          rating?: number\r\n          total_patients?: number\r\n          created_at?: string\r\n          updated_at?: string\r\n        }\r\n        Update: {\r\n          id?: string\r\n          user_id?: string\r\n          specialty?: string\r\n          license_number?: string\r\n          experience_years?: number\r\n          education?: string | null\r\n          hospital_id?: string | null\r\n          consultation_fee?: number | null\r\n          available_days?: string[]\r\n          available_hours?: string\r\n          bio?: string | null\r\n          rating?: number\r\n          total_patients?: number\r\n          updated_at?: string\r\n        }\r\n      }\r\n      hospitals: {\r\n        Row: {\r\n          id: string\r\n          user_id: string\r\n          name: string\r\n          address: string\r\n          phone: string\r\n          email: string\r\n          website: string | null\r\n          license_number: string\r\n          total_beds: number\r\n          available_beds: number\r\n          departments: string[]\r\n          services: string[]\r\n          emergency_services: boolean\r\n          rating: number\r\n          created_at: string\r\n          updated_at: string\r\n        }\r\n        Insert: {\r\n          id?: string\r\n          user_id: string\r\n          name: string\r\n          address: string\r\n          phone: string\r\n          email: string\r\n          website?: string | null\r\n          license_number: string\r\n          total_beds: number\r\n          available_beds: number\r\n          departments: string[]\r\n          services: string[]\r\n          emergency_services?: boolean\r\n          rating?: number\r\n          created_at?: string\r\n          updated_at?: string\r\n        }\r\n        Update: {\r\n          id?: string\r\n          user_id?: string\r\n          name?: string\r\n          address?: string\r\n          phone?: string\r\n          email?: string\r\n          website?: string | null\r\n          license_number?: string\r\n          total_beds?: number\r\n          available_beds?: number\r\n          departments?: string[]\r\n          services?: string[]\r\n          emergency_services?: boolean\r\n          rating?: number\r\n          updated_at?: string\r\n        }\r\n      }\r\n      health_records: {\r\n        Row: {\r\n          id: string\r\n          user_id: string\r\n          family_member_id: string | null\r\n          title: string\r\n          type: 'lab_report' | 'prescription' | 'xray' | 'scan' | 'consultation' | 'other'\r\n          file_url: string | null\r\n          file_type: string | null\r\n          content: string | null\r\n          doctor_id: string | null\r\n          hospital_id: string | null\r\n          date_recorded: string\r\n          ai_summary: string | null\r\n          tags: string[]\r\n          is_critical: boolean\r\n          created_at: string\r\n          updated_at: string\r\n        }\r\n        Insert: {\r\n          id?: string\r\n          user_id: string\r\n          family_member_id?: string | null\r\n          title: string\r\n          type: 'lab_report' | 'prescription' | 'xray' | 'scan' | 'consultation' | 'other'\r\n          file_url?: string | null\r\n          file_type?: string | null\r\n          content?: string | null\r\n          doctor_id?: string | null\r\n          hospital_id?: string | null\r\n          date_recorded: string\r\n          ai_summary?: string | null\r\n          tags?: string[]\r\n          is_critical?: boolean\r\n          created_at?: string\r\n          updated_at?: string\r\n        }\r\n        Update: {\r\n          id?: string\r\n          user_id?: string\r\n          family_member_id?: string | null\r\n          title?: string\r\n          type?: 'lab_report' | 'prescription' | 'xray' | 'scan' | 'consultation' | 'other'\r\n          file_url?: string | null\r\n          file_type?: string | null\r\n          content?: string | null\r\n          doctor_id?: string | null\r\n          hospital_id?: string | null\r\n          date_recorded?: string\r\n          ai_summary?: string | null\r\n          tags?: string[]\r\n          is_critical?: boolean\r\n          updated_at?: string\r\n        }\r\n      }\r\n      vital_signs: {\r\n        Row: {\r\n          id: string\r\n          user_id: string\r\n          family_member_id: string | null\r\n          type: 'blood_pressure' | 'heart_rate' | 'temperature' | 'weight' | 'height' | 'blood_sugar' | 'oxygen_saturation'\r\n          value: string\r\n          unit: string\r\n          notes: string | null\r\n          recorded_at: string\r\n          created_at: string\r\n        }\r\n        Insert: {\r\n          id?: string\r\n          user_id: string\r\n          family_member_id?: string | null\r\n          type: 'blood_pressure' | 'heart_rate' | 'temperature' | 'weight' | 'height' | 'blood_sugar' | 'oxygen_saturation'\r\n          value: string\r\n          unit: string\r\n          notes?: string | null\r\n          recorded_at: string\r\n          created_at?: string\r\n        }\r\n        Update: {\r\n          id?: string\r\n          user_id?: string\r\n          family_member_id?: string | null\r\n          type?: 'blood_pressure' | 'heart_rate' | 'temperature' | 'weight' | 'height' | 'blood_sugar' | 'oxygen_saturation'\r\n          value?: string\r\n          unit?: string\r\n          notes?: string | null\r\n          recorded_at?: string\r\n        }\r\n      }\r\n      appointments: {\r\n        Row: {\r\n          id: string\r\n          patient_id: string\r\n          doctor_id: string\r\n          hospital_id: string | null\r\n          appointment_date: string\r\n          appointment_time: string\r\n          duration: number\r\n          type: 'consultation' | 'follow_up' | 'emergency' | 'telemedicine'\r\n          status: 'scheduled' | 'confirmed' | 'in_progress' | 'completed' | 'cancelled' | 'no_show'\r\n          reason: string\r\n          notes: string | null\r\n          prescription_id: string | null\r\n          fee: number | null\r\n          payment_status: 'pending' | 'paid' | 'refunded'\r\n          created_at: string\r\n          updated_at: string\r\n        }\r\n        Insert: {\r\n          id?: string\r\n          patient_id: string\r\n          doctor_id: string\r\n          hospital_id?: string | null\r\n          appointment_date: string\r\n          appointment_time: string\r\n          duration?: number\r\n          type: 'consultation' | 'follow_up' | 'emergency' | 'telemedicine'\r\n          status?: 'scheduled' | 'confirmed' | 'in_progress' | 'completed' | 'cancelled' | 'no_show'\r\n          reason: string\r\n          notes?: string | null\r\n          prescription_id?: string | null\r\n          fee?: number | null\r\n          payment_status?: 'pending' | 'paid' | 'refunded'\r\n          created_at?: string\r\n          updated_at?: string\r\n        }\r\n        Update: {\r\n          id?: string\r\n          patient_id?: string\r\n          doctor_id?: string\r\n          hospital_id?: string | null\r\n          appointment_date?: string\r\n          appointment_time?: string\r\n          duration?: number\r\n          type?: 'consultation' | 'follow_up' | 'emergency' | 'telemedicine'\r\n          status?: 'scheduled' | 'confirmed' | 'in_progress' | 'completed' | 'cancelled' | 'no_show'\r\n          reason?: string\r\n          notes?: string | null\r\n          prescription_id?: string | null\r\n          fee?: number | null\r\n          payment_status?: 'pending' | 'paid' | 'refunded'\r\n          updated_at?: string\r\n        }\r\n      }\r\n      prescriptions: {\r\n        Row: {\r\n          id: string\r\n          doctor_id: string\r\n          patient_id: string\r\n          appointment_id: string | null\r\n          medications: any[]\r\n          instructions: string | null\r\n          valid_until: string\r\n          status: 'active' | 'expired' | 'cancelled'\r\n          created_at: string\r\n          updated_at: string\r\n        }\r\n        Insert: {\r\n          id?: string\r\n          doctor_id: string\r\n          patient_id: string\r\n          appointment_id?: string | null\r\n          medications: any[]\r\n          instructions?: string | null\r\n          valid_until: string\r\n          status?: 'active' | 'expired' | 'cancelled'\r\n          created_at?: string\r\n          updated_at?: string\r\n        }\r\n        Update: {\r\n          id?: string\r\n          doctor_id?: string\r\n          patient_id?: string\r\n          appointment_id?: string | null\r\n          medications?: any[]\r\n          instructions?: string | null\r\n          valid_until?: string\r\n          status?: 'active' | 'expired' | 'cancelled'\r\n          updated_at?: string\r\n        }\r\n      }\r\n    }\r\n  }\r\n}"],"names":[],"mappings":";;;;AAAA;;AAEA,MAAM;AACN,MAAM;AAEC,MAAM,WAAW,IAAA,uNAAY,EAAC,aAAa"}},
    {"offset": {"line": 59, "column": 0}, "map": {"version":3,"sources":["file:///D:/MediSaathi/app/api/vitals/route.ts"],"sourcesContent":["import { NextRequest, NextResponse } from 'next/server'\r\nimport { supabase } from '@/lib/supabase'\r\n\r\nexport async function GET(request: NextRequest) {\r\n  try {\r\n    const { searchParams } = new URL(request.url)\r\n    const userId = searchParams.get('userId')\r\n    const action = searchParams.get('action')\r\n\r\n    if (!userId) {\r\n      return NextResponse.json({ \r\n        success: false, \r\n        error: 'User ID is required' \r\n      }, { status: 400 })\r\n    }\r\n\r\n    if (action === 'latest' || !action) {\r\n      // Get latest vital signs readings\r\n      const { data: vitals, error } = await supabase\r\n        .from('vital_signs')\r\n        .select(`\r\n          id,\r\n          type,\r\n          value,\r\n          unit,\r\n          recorded_at\r\n        `)\r\n        .eq('user_id', userId)\r\n        .order('recorded_at', { ascending: false })\r\n        .limit(20)\r\n\r\n      if (error) {\r\n        console.error('Database error:', error)\r\n        return NextResponse.json({ \r\n          success: false, \r\n          error: 'Failed to fetch vital signs',\r\n          details: error.message\r\n        }, { status: 500 })\r\n      }\r\n\r\n      // Group by type and get latest for each\r\n      const latestByType = vitals?.reduce((acc: any[], vital: any) => {\r\n        if (!acc.find(v => v.type === vital.type)) {\r\n          acc.push({\r\n            type: vital.type,\r\n            data: {\r\n              value: vital.value,\r\n              unit: vital.unit,\r\n              recorded_at: vital.recorded_at\r\n            }\r\n          })\r\n        }\r\n        return acc\r\n      }, []) || []\r\n\r\n      return NextResponse.json({ \r\n        success: true, \r\n        data: latestByType \r\n      })\r\n    }\r\n\r\n    return NextResponse.json({ \r\n      success: false, \r\n      error: 'Invalid action' \r\n    }, { status: 400 })\r\n\r\n  } catch (error) {\r\n    console.error('Vitals API error:', error)\r\n    return NextResponse.json({ \r\n      success: false, \r\n      error: 'Internal server error',\r\n      details: error instanceof Error ? error.message : 'Unknown error'\r\n    }, { status: 500 })\r\n  }\r\n}\r\n\r\nexport async function POST(request: NextRequest) {\r\n  try {\r\n    const body = await request.json()\r\n    const { user_id, type, value, unit } = body\r\n\r\n    if (!user_id || !type || !value) {\r\n      return NextResponse.json({ \r\n        success: false, \r\n        error: 'Missing required fields: user_id, type, value' \r\n      }, { status: 400 })\r\n    }\r\n\r\n    // Check for abnormal readings\r\n    const isAbnormal = checkAbnormalVital(type, value)\r\n\r\n    const { data: vital, error } = await supabase\r\n      .from('vital_signs')\r\n      .insert({\r\n        user_id,\r\n        type,\r\n        value,\r\n        unit: unit || '',\r\n        recorded_at: new Date().toISOString()\r\n      })\r\n      .select()\r\n      .single()\r\n\r\n    if (error) {\r\n      console.error('Database error:', error)\r\n      return NextResponse.json({ \r\n        success: false, \r\n        error: 'Failed to record vital signs',\r\n        details: error.message\r\n      }, { status: 500 })\r\n    }\r\n\r\n    return NextResponse.json({ \r\n      success: true, \r\n      data: vital,\r\n      abnormal: isAbnormal\r\n    })\r\n\r\n  } catch (error) {\r\n    console.error('Vitals POST API error:', error)\r\n    return NextResponse.json({ \r\n      success: false, \r\n      error: 'Internal server error',\r\n      details: error instanceof Error ? error.message : 'Unknown error'\r\n    }, { status: 500 })\r\n  }\r\n}\r\n\r\nfunction checkAbnormalVital(type: string, value: string) {\r\n  const numValue = parseFloat(value)\r\n  \r\n  switch (type) {\r\n    case 'heart_rate':\r\n      if (numValue < 60 || numValue > 100) {\r\n        return { isAbnormal: true, message: 'Heart rate is outside normal range (60-100 bpm)' }\r\n      }\r\n      break\r\n    case 'temperature':\r\n      if (numValue < 97.0 || numValue > 100.4) {\r\n        return { isAbnormal: true, message: 'Temperature is outside normal range (97.0-100.4Â°F)' }\r\n      }\r\n      break\r\n    case 'blood_sugar':\r\n      if (numValue < 70 || numValue > 140) {\r\n        return { isAbnormal: true, message: 'Blood sugar is outside normal range (70-140 mg/dL)' }\r\n      }\r\n      break\r\n    case 'blood_pressure':\r\n      const [systolic, diastolic] = value.split('/').map(v => parseInt(v))\r\n      if (systolic > 140 || diastolic > 90 || systolic < 90 || diastolic < 60) {\r\n        return { isAbnormal: true, message: 'Blood pressure is outside normal range' }\r\n      }\r\n      break\r\n  }\r\n  \r\n  return { isAbnormal: false, message: '' }\r\n}"],"names":[],"mappings":"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"}}]
}