{
  "version": 3,
  "sources": [],
  "sections": [
    {"offset": {"line": 106, "column": 0}, "map": {"version":3,"sources":["file:///D:/MediSaathi/app/api/profile/route.ts"],"sourcesContent":["import { NextRequest, NextResponse } from 'next/server'\r\nimport { getServerSession } from 'next-auth/next'\r\nimport { createClient } from '@supabase/supabase-js'\r\n\r\n// Create admin client that bypasses RLS\r\nconst supabaseAdmin = createClient(\r\n  process.env.NEXT_PUBLIC_SUPABASE_URL!,\r\n  process.env.SUPABASE_JWT_SECRET!,\r\n  {\r\n    auth: {\r\n      autoRefreshToken: false,\r\n      persistSession: false\r\n    }\r\n  }\r\n)\r\n\r\nexport async function PUT(request: NextRequest) {\r\n  try {\r\n    const session = await getServerSession()\r\n    \r\n    if (!session?.user?.email) {\r\n      return NextResponse.json({ success: false, error: 'Unauthorized' }, { status: 401 })\r\n    }\r\n\r\n    const body = await request.json()\r\n    const { user_type, full_name, specialty, license_number } = body\r\n\r\n    // Update user profile\r\n    const { data, error } = await supabaseAdmin\r\n      .from('users')\r\n      .update({\r\n        user_type,\r\n        full_name,\r\n        specialty,\r\n        license_number,\r\n        updated_at: new Date().toISOString()\r\n      })\r\n      .eq('email', session.user.email)\r\n      .select()\r\n      .single()\r\n\r\n    if (error) {\r\n      console.error('Profile update error:', error)\r\n      return NextResponse.json({ success: false, error: 'Failed to update profile' }, { status: 500 })\r\n    }\r\n\r\n    return NextResponse.json({ success: true, data })\r\n  } catch (error) {\r\n    console.error('API Error:', error)\r\n    return NextResponse.json({ success: false, error: 'Internal server error' }, { status: 500 })\r\n  }\r\n}\r\n\r\nexport async function GET(request: NextRequest) {\r\n  try {\r\n    const session = await getServerSession()\r\n    \r\n    if (!session?.user?.email) {\r\n      return NextResponse.json({ success: false, error: 'Unauthorized' }, { status: 401 })\r\n    }\r\n\r\n    // Get user profile\r\n    const { data, error } = await supabaseAdmin\r\n      .from('users')\r\n      .select('*')\r\n      .eq('email', session.user.email)\r\n      .single()\r\n\r\n    if (error) {\r\n      console.error('Profile fetch error:', error)\r\n      return NextResponse.json({ success: false, error: 'Failed to fetch profile' }, { status: 500 })\r\n    }\r\n\r\n    return NextResponse.json({ success: true, data })\r\n  } catch (error) {\r\n    console.error('API Error:', error)\r\n    return NextResponse.json({ success: false, error: 'Internal server error' }, { status: 500 })\r\n  }\r\n}"],"names":[],"mappings":";;;;;;AAAA;AACA;AACA;;;;AAEA,wCAAwC;AACxC,MAAM,gBAAgB,IAAA,uNAAY,gFAEhC,QAAQ,GAAG,CAAC,mBAAmB,EAC/B;IACE,MAAM;QACJ,kBAAkB;QAClB,gBAAgB;IAClB;AACF;AAGK,eAAe,IAAI,OAAoB;IAC5C,IAAI;QACF,MAAM,UAAU,MAAM,IAAA,iLAAgB;QAEtC,IAAI,CAAC,SAAS,MAAM,OAAO;YACzB,OAAO,8JAAY,CAAC,IAAI,CAAC;gBAAE,SAAS;gBAAO,OAAO;YAAe,GAAG;gBAAE,QAAQ;YAAI;QACpF;QAEA,MAAM,OAAO,MAAM,QAAQ,IAAI;QAC/B,MAAM,EAAE,SAAS,EAAE,SAAS,EAAE,SAAS,EAAE,cAAc,EAAE,GAAG;QAE5D,sBAAsB;QACtB,MAAM,EAAE,IAAI,EAAE,KAAK,EAAE,GAAG,MAAM,cAC3B,IAAI,CAAC,SACL,MAAM,CAAC;YACN;YACA;YACA;YACA;YACA,YAAY,IAAI,OAAO,WAAW;QACpC,GACC,EAAE,CAAC,SAAS,QAAQ,IAAI,CAAC,KAAK,EAC9B,MAAM,GACN,MAAM;QAET,IAAI,OAAO;YACT,QAAQ,KAAK,CAAC,yBAAyB;YACvC,OAAO,8JAAY,CAAC,IAAI,CAAC;gBAAE,SAAS;gBAAO,OAAO;YAA2B,GAAG;gBAAE,QAAQ;YAAI;QAChG;QAEA,OAAO,8JAAY,CAAC,IAAI,CAAC;YAAE,SAAS;YAAM;QAAK;IACjD,EAAE,OAAO,OAAO;QACd,QAAQ,KAAK,CAAC,cAAc;QAC5B,OAAO,8JAAY,CAAC,IAAI,CAAC;YAAE,SAAS;YAAO,OAAO;QAAwB,GAAG;YAAE,QAAQ;QAAI;IAC7F;AACF;AAEO,eAAe,IAAI,OAAoB;IAC5C,IAAI;QACF,MAAM,UAAU,MAAM,IAAA,iLAAgB;QAEtC,IAAI,CAAC,SAAS,MAAM,OAAO;YACzB,OAAO,8JAAY,CAAC,IAAI,CAAC;gBAAE,SAAS;gBAAO,OAAO;YAAe,GAAG;gBAAE,QAAQ;YAAI;QACpF;QAEA,mBAAmB;QACnB,MAAM,EAAE,IAAI,EAAE,KAAK,EAAE,GAAG,MAAM,cAC3B,IAAI,CAAC,SACL,MAAM,CAAC,KACP,EAAE,CAAC,SAAS,QAAQ,IAAI,CAAC,KAAK,EAC9B,MAAM;QAET,IAAI,OAAO;YACT,QAAQ,KAAK,CAAC,wBAAwB;YACtC,OAAO,8JAAY,CAAC,IAAI,CAAC;gBAAE,SAAS;gBAAO,OAAO;YAA0B,GAAG;gBAAE,QAAQ;YAAI;QAC/F;QAEA,OAAO,8JAAY,CAAC,IAAI,CAAC;YAAE,SAAS;YAAM;QAAK;IACjD,EAAE,OAAO,OAAO;QACd,QAAQ,KAAK,CAAC,cAAc;QAC5B,OAAO,8JAAY,CAAC,IAAI,CAAC;YAAE,SAAS;YAAO,OAAO;QAAwB,GAAG;YAAE,QAAQ;QAAI;IAC7F;AACF"}}]
}